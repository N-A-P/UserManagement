<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mockproject.du1.mapper.CustomerMapper">


    <!--Get List Data User Information -->
    <resultMap id="GetCustomerResultMap"
               type="com.mockproject.du1.model.Customer">
		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="first_name" property="firstName" jdbcType="VARCHAR" />
		<result column="last_name" property="lastName" jdbcType="VARCHAR" />
		<result column="dob" property="dob" jdbcType="DATE" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="address" property="address" jdbcType="VARCHAR" />
		<result column="company" property="company" jdbcType="VARCHAR" />
		<result column="is_activated" property="isActivated" jdbcType="INTEGER" />
		<result column="updated_by" property="updatedBy" jdbcType="VARCHAR" />
		<result column="created_timestamp" property="createdTimestamp" jdbcType="TIMESTAMP" />
		<result column="updated_timestamp" property="updatedTimestamp" jdbcType="TIMESTAMP" />

    </resultMap>
	<sql id="Base_Column_List" >
		<!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Nov 05 09:11:00 ICT 2019.
        -->
		id, first_name, last_name, dob, email, address, company, is_activated, updated_by,
		created_timestamp, updated_timestamp
	</sql>
	<select id="selectByPrimaryKey" parameterType="int" resultMap="GetCustomerResultMap">
	select
	   c.*,
	   a.id
	  from
	  campaign a inner join campaign_customer b
	  on a.id=b.campaign_id
	  inner join customer c on c.id=b.customer_id
	  where
	  b.sent_date=(select max(sent_date) from campaign_customer d where d.campaign_id=a.id)
		and a.id = #{campaign_id}
</select>

    <insert id="sqlCreateCustomerInsert" parameterType="com.mockproject.du1.model.Customer">
		insert into customer (first_name, last_name, dob,
      email, address, company,
      is_activated, updated_by, created_timestamp,
      updated_timestamp)
    values (#{firstName,jdbcType=VARCHAR}, #{lastName,jdbcType=VARCHAR}, #{dob,jdbcType=DATE},
      #{email,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, #{company,jdbcType=VARCHAR},
      #{isActivated,jdbcType=INTEGER}, #{updatedBy,jdbcType=VARCHAR}, #{createdTimestamp,jdbcType=TIMESTAMP},
      #{updatedTimestamp,jdbcType=TIMESTAMP})
	</insert>

    <select id="sqlGetCustomerByEmailSelect"
            resultMap="GetCustomerResultMap" parameterType="String">
		select
		<include refid="Base_Column_List" />
		from customer
		WHERE
		email = #{customerEmail}
	</select>
    <select id="sqlGetAllCustomer"
            resultMap="GetCustomerResultMap" >
		select
		<include refid="Base_Column_List" />
		from customer
	</select>
    <select id="sqlGetCustomerByCampaignAndMaxTime"
            resultMap="GetCustomerResultMap" parameterType="int">
	select
	 c.id,
	 c.first_name,
	 c.last_name,
	 c.dob,
	 c.email,
	 c.is_activated,
	 c.updated_by,
	 c.created_timestamp,
	 c.updated_timestamp,
	 c.address,
	 c.company
	  from
	  campaign a inner join campaign_customer b
	  on a.id=b.campaign_id
	  inner join customer c on c.id=b.customer_id
	  where
	  b.sent_date=(select max(sent_date) from campaign_customer d where d.campaign_id=a.id)
	 and a.id=#{CampaignId}  group by c.id
	</select>

</mapper>